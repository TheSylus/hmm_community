
import React, { createContext, useState, useEffect, useContext, ReactNode, useMemo, useCallback } from 'react';

const enTranslations = {
  "nav.myItems": "My Items",
  "nav.family": "Family",
  "header.title": "Food Memory Tracker",
  "header.searchPlaceholder": "Search by name, notes, tags...",
  "header.filter.button": "Filters",
  "header.filter.all": "All Items",
  "header.filter.liked": "Liked (4-5 Stars)",
  "header.filter.disliked": "Disliked (1-2 Stars)",
  "header.filter.type.all": "All Types",
  "header.filter.type.products": "Products",
  "header.filter.type.dishes": "Dishes",
  "header.filter.type.drugstore": "Drugstore",
  "header.filter.active.search": "Search: \"{term}\"",
  "header.filter.active.aiSearch": "AI: \"{term}\"",
  "header.filter.active.type.product": "Type: Products",
  "header.filter.active.type.dish": "Type: Dishes",
  "header.filter.active.type.drugstore": "Type: Drugstore",
  "header.filter.active.rating.liked": "Liked Items",
  "header.filter.active.rating.disliked": "Disliked Items",
  "header.filter.clearAll": "Clear all",
  "header.sort.dateDesc": "Date (Newest First)",
  "header.sort.dateAsc": "Date (Oldest First)",
  "header.sort.ratingDesc": "Rating (High to Low)",
  "header.sort.ratingAsc": "Rating (Low to High)",
  "header.sort.nameAsc": "Name (A-Z)",
  "header.sort.nameDesc": "Name (Z-A)",
  "header.shoppingListAria": "Open Shopping List",
  "footer.text": "Never forget a favorite again.",
  "filterPanel.title": "Filter & Sort",
  "filterPanel.search": "Search term",
  "filterPanel.aiSearchTitle": "AI-Powered Search",
  "filterPanel.filterByType": "Filter by Type",
  "filterPanel.filterByRating": "Filter by Rating",
  "filterPanel.sortBy": "Sort by",
  "filterPanel.reset": "Reset Filters",
  "filterPanel.apply": "Apply",
  "dashboard.title": "Dashboard",
  "dashboard.welcome": "Welcome Back!",
  "dashboard.recentlyAdded": "Recently Added",
  "dashboard.topRated": "Your Top Rated",
  "dashboard.viewAll": "View All Items",
  "dashboard.empty.title": "Your culinary journey starts here!",
  "dashboard.empty.description": "Add your first product or dish to see your personal dashboard come to life.",
  "family.title": "Family Favorites",
  "family.loading": "Loading Family Favorites...",
  "family.empty.title": "No Family Favorites Yet!",
  "family.empty.description": "When you or someone in your household adds an item and marks it as a favorite, it will appear here.",
  "family.noHousehold.title": "Join a Household to see Family Favorites",
  "family.noHousehold.description": "Create or join a household in the settings to start sharing items and shopping lists with your family.",
  "conversationalSearch.placeholder": "Ask about your food... (e.g., a gluten-free snack I liked)",
  "conversationalSearch.tooltip": "Search with AI",
  "conversationalSearch.buttonAria": "Search with AI",
  "conversationalSearch.searching": "AI is thinking...",
  "conversationalSearch.error": "AI search failed. Please try a different query.",
  "conversationalSearch.resultsTitle": "AI Search Results",
  "conversationalSearch.clear": "Clear AI Search",
  "shoppingList.title": "Shared List",
  "shoppingList.empty": "This list is empty. Add products from their cards to get started.",
  "shoppingList.clear": "Clear Completed",
  "shoppingList.addAria": "Add {name} to shopping list",
  "shoppingList.removeAria": "Remove {name} from shopping list",
  "shoppingList.toggleDetailsAria": "Toggle details",
  "shoppingList.addedToast": "{name} added to list.",
  "shoppingList.addedAnotherToast": "Added another {name} to the list.",
  "shoppingList.quantity": "Quantity",
  "shoppingList.uncategorized": "Uncategorized",
  "shoppingList.defaultListName": "Household Groceries",
  "shoppingList.joinSuccess": "Successfully joined household: {householdName}!",
  "shoppingList.selectListAria": "Select a shared list",
  "shoppingList.newListButton": "Create New List",
  "shoppingList.newListPlaceholder": "New list name...",
  "shoppingList.createButton": "Create",
  "shoppingList.share.inviteButton": "Invite Members",
  "shoppingList.share.linkCopied": "Invite Link Copied!",
  "shoppingList.share.copyFailed": "Could not copy link. Please copy it manually.",
  "shoppingList.collaboration.members": "Members",
  "shoppingList.collaboration.you": "You",
  "shoppingList.collaboration.someone": "Someone",
  "shoppingList.collaboration.addedBy": "Added by {name}",
  "shoppingList.collaboration.checkedBy": "Checked by {name}",
  "shoppingList.manage.buttonTitle": "Manage list",
  "shoppingList.delete.button": "Delete List",
  "shoppingList.delete.confirm": "Are you sure you want to permanently delete the list \"{listName}\"? This action cannot be undone.",
  "shoppingList.mode.startShopping": "Start Shopping",
  "shoppingList.mode.done": "Done",
  "shoppingList.mode.completed": "Completed",
  "shoppingList.mode.clearCompleted": "Clear {count} Completed",
  "shoppingList.quickAdd.placeholder": "Smart Add (e.g., Milk, 2 Eggs, Apples)",
  "shoppingList.quickAdd.processing": "Processing...",
  "form.addNewButton": "Add New Item",
  "form.editTitle": "Edit Food Item",
  "form.placeholder.name": "Product Name",
  "form.placeholder.dishName": "Dish Name (e.g., Spaghetti Carbonara)",
  "form.placeholder.restaurant": "Restaurant Name",
  "form.placeholder.cuisine": "Cuisine Type (e.g., Italian)",
  "form.placeholder.price": "Price",
  "form.placeholder.purchaseLocation": "Store / Location (e.g. Lidl, Aldi - comma separated)",
  "form.label.rating": "Rating:",
  "form.aria.rate": "Rate {star} star",
  "form.aria.ratePlural": "Rate {star} stars",
  "form.placeholder.notes": "Notes (e.g., taste, where you bought it)",
  "form.placeholder.tags": "Tags (comma, separated)",
  "form.label.nutriScore": "Nutri-Score:",
  "form.aria.selectNutriScore": "Select Nutri-Score {score}",
  "form.label.selectRestaurant": "Or select a nearby restaurant:",
  "form.placeholder.selectRestaurant": "-- Select a restaurant --",
  "form.error.nameAndRating": "Please provide a name and a rating.",
  "form.error.genericAiError": "Could not analyze image with AI. Please try again or enter details manually.",
  "form.error.ingredientsAiError": "Could not analyze ingredients list.",
  "form.error.barcodeError": "Could not fetch product data for this barcode. The product may not be in the Open Food/Beauty Facts database.",
  "form.error.offSearchDisabled": "Food Database Search is disabled in settings. You can enable it to use this feature.",
  "form.error.geolocationUnsupported": "Geolocation is not supported by your browser.",
  "form.error.geolocationPermission": "Could not get location. Please enable location services and grant permission.",
  "form.error.findRestaurants": "Could not find nearby restaurants. Please try again or enter manually.",
  "form.button.cancel": "Cancel",
  "form.button.save": "Save Item",
  "form.button.update": "Update Item",
  "form.button.scanIngredients": "Scan Ingredients",
  "form.button.scanBarcode": "Scan Barcode",
  "form.button.dictate": "Dictate",
  "form.button.takePhoto": "Take Photo",
  "form.button.findNearby.aria": "Find nearby restaurants",
  "form.findRestaurants.loading": "Finding nearby restaurants...",
  "form.image.removeAria": "Remove image",
  "form.image.placeholder": "Scan a product or upload an image to start",
  "form.button.scanNew": "Scan Photo",
  "form.button.upload": "Upload",
  "form.aiProgress.readingName": "Reading product name...",
  "form.aiProgress.findingScore": "Finding Nutri-Score...",
  "form.aiProgress.generatingTags": "Generating descriptive tags...",
  "form.aiProgress.searchingDatabase": "Searching database for extra info...",
  "form.aiProgress.locatingProduct": "Locating product in image...",
  "form.aiProgress.complete": "Analysis Complete!",
  "form.ingredients.title": "Ingredients & Dietary Info",
  "form.ingredients.loading": "Scanning ingredients list...",
  "form.ingredients.ingredientsList": "Ingredients",
  "form.ingredients.placeholder": "No ingredients found. Scan the barcode or ingredients list to add them.",
  "form.allergens.title": "Allergens",
  "form.dietary.title": "Dietary Information",
  "form.attributes.title": "Product Attributes",
  "form.dietary.lactoseFree": "Lactose-Free",
  "form.dietary.vegan": "Vegan",
  "form.dietary.glutenFree": "Gluten-Free",
  "form.category.title": "Category",
  "form.familyFavorite.title": "Mark as Family Favorite",
  "form.familyFavorite.description": "Makes this item visible to everyone in your household.",
  "list.empty.title": "Your list is empty!",
  "list.empty.description": "Add a food item using the form above to start tracking your preferences.",
  "list.resultsFor": "Results for \"{searchTerm}\"",
  "card.deleteAria": "Delete {name}",
  "card.editAria": "Edit {name}",
  "card.shareAria": "Share {name}",
  "card.lactoseFreeTooltip": "Lactose-Free",
  "card.veganTooltip": "Vegan",
  "card.glutenFreeTooltip": "Gluten-Free",
  "card.productTooltip": "Packaged Product",
  "card.dishTooltip": "Restaurant Dish",
  "card.drugstoreTooltip": "Drugstore Item",
  "card.familyFavoriteTooltip": "Family Favorite",
  "card.privateTooltip": "Private Item",
  "card.dishAt": "at {restaurant}",
  "share.title": "Check out this product: {name}",
  "share.text": "I gave \"{name}\" a {rating}/5 star rating. See my thoughts on the Food Memory Tracker app!",
  "share.text_unrated": "Check out \"{name}\" on the Food Memory Tracker app!",
  "camera.title": "Take a Picture",
  "camera.error": "Could not access the camera. Please check permissions and try again.",
  "camera.error.permission": "Camera access was denied. Please check your browser and system settings to grant permission.",
  "camera.captureButton": "Capture Photo",
  "barcodeScanner.title": "Scan Barcode",
  "barcodeScanner.description": "Point your camera at the product's barcode.",
  "barcodeScanner.error.permission": "Camera access was denied. Please allow camera access in your browser settings.",
  "cropper.title": "Adjust Crop",
  "cropper.description": "Adjust the selection proposed by the AI or cancel to use the full image.",
  "cropper.button.cancel": "Cancel (Use Full)",
  "cropper.button.confirm": "Confirm Crop",
  "modal.image.closeAria": "Close image view",
  "modal.duplicate.title": "Potential Duplicate Found",
  "modal.duplicate.description": "An item named \"{itemName}\" already exists. Please review the item(s) below.",
  "modal.duplicate.button.goBack": "Go Back & Edit",
  "modal.duplicate.button.addAnyway": "Add Anyway",
  "modal.shared.title": "Shared Food Item",
  "modal.shared.description": "Someone shared this item with you. Would you like to add it to your list?",
  "modal.shared.addToList": "Add to My List",
  "modal.shared.close": "Close",
  "modal.shared.summaryNotice": "Note: This is a summary. Some details like notes, ingredients, or allergens may not be included in the share.",
  "modal.itemType.title": "What are you adding?",
  "modal.itemType.product": "Packaged Product",
  "modal.itemType.dish": "Restaurant Dish",
  "modal.itemType.drugstore": "Drugstore Item",
  "speechModal.title": "Dictate Name",
  "speechModal.description": "Start speaking, and the name will be transcribed.",
  "speechModal.listening": "Listening...",
  "settings.title": "Settings",
  "settings.closeAria": "Close settings",
  "settings.theme.title": "Theme",
  "settings.theme.light": "Light",
  "settings.theme.dark": "Dark",
  "settings.theme.system": "System",
  "settings.language.title": "Language",
  "settings.ai.title": "AI Features",
  "settings.ai.description": "Enable AI analysis to auto-fill details from photos.",
  "settings.barcodeScanner.title": "Barcode Scanner",
  "settings.barcodeScanner.description": "Enable the barcode scanner feature to look up products.",
  "settings.offSearch.title": "Food Database Search",
  "settings.offSearch.description": "Enable automatic search for product info in the Open Food Facts database.",
  "settings.shops.title": "Preferred Stores",
  "settings.shops.description": "Add stores you frequent. These will appear as quick-select options when adding items.",
  "settings.shops.placeholder": "Add store name...",
  "settings.button.done": "Done",
  "settings.session.title": "Account",
  "settings.session.loggedInAs": "Logged in as:",
  "settings.session.logout": "Logout",
  "settings.household.title": "Household",
  "settings.household.create.button": "Create Household",
  "settings.household.create.placeholder": "Household Name (e.g., Smith Family)",
  "settings.household.join.description": "Ask a household member for an invite link.",
  "settings.household.manage.members": "Members",
  "settings.household.manage.activeMembers": "Active Members:",
  "settings.household.manage.invite": "Invite Members",
  "settings.household.manage.leave": "Leave Household",
  "settings.household.manage.leaveConfirm": "Are you sure you want to leave this household?",
  "settings.household.manage.delete": "Delete Household",
  "settings.household.manage.deleteConfirm": "Are you sure? This will delete the household and all shared data for everyone. This cannot be undone.",
  "settings.household.manage.linkCopied": "Invite link copied to clipboard!",
  "household.error.rls.insert": "Permission Denied: Database security rules prevent creating a household. This is a Supabase configuration issue. **Solution:** Go to Supabase SQL Editor and run these commands: `CREATE POLICY \"Allow insert\" ON public.households FOR INSERT WITH CHECK (auth.uid() = owner_id);` and `CREATE POLICY \"Allow select\" ON public.households FOR SELECT USING (auth.uid() = owner_id);`",
  "household.error.generic": "Error creating household: {message}",
  "settings.troubleshoot.title": "Database Repair",
  "settings.troubleshoot.description": "If family members cannot see items or lists, run this script in the Supabase SQL Editor.",
  "settings.troubleshoot.description_category": "If you see 'Could not find the category column' error, run this script in Supabase SQL Editor to add the missing column.",
  "settings.troubleshoot.button": "Show Fix Script",
  "settings.troubleshoot.sqlInstructions": "Copy this code and run it in the Supabase SQL Editor.",
  "auth.emailPlaceholder": "Email",
  "auth.passwordPlaceholder": "Password",
  "auth.signIn": "Sign In",
  "auth.signUp": "Sign Up",
  "auth.magicLink": "Send Magic Link",
  "auth.magicLinkSuccess": "Check your email for the login link!",
  "auth.toggle.signUp": "Don't have an account? Sign Up",
  "auth.toggle.signIn": "Already have an account? Sign In",
  "auth.error.generic": "Authentication failed. Please try again.",
  "allergen.gluten": "Contains Gluten",
  "allergen.dairy": "Contains Dairy",
  "allergen.peanuts": "Contains Peanuts",
  "allergen.tree_nuts": "Contains Tree Nuts",
  "allergen.soy": "Contains Soy",
  "allergen.eggs": "Contains Eggs",
  "allergen.fish": "Contains Fish",
  "allergen.shellfish": "Contains Shellfish",
  "category.produce": "Produce",
  "category.bakery": "Bakery",
  "category.meat_fish": "Meat & Fish",
  "category.dairy_eggs": "Dairy & Eggs",
  "category.pantry": "Pantry",
  "category.frozen": "Frozen",
  "category.snacks": "Snacks & Sweets",
  "category.beverages": "Beverages",
  "category.household": "Household",
  "category.personal_care": "Personal Care",
  "category.restaurant_food": "Restaurant",
  "category.pet_food": "Pet Food",
  "category.other": "Other",
  "detail.notesTitle": "Notes",
  "detail.tagsTitle": "Tags",
  "detail.ingredientsTitle": "Ingredients",
  "detail.allergensTitle": "Allergens",
  "detail.dietaryTitle": "Dietary Information",
  "detail.status": "Status",
  "detail.statusFamilyFavorite": "Family Favorite",
  "detail.statusPrivate": "Private",
  "offline.message": "You are currently offline. Changes will be saved and synced when you reconnect.",
  "offline.syncComplete": "Back online! Your data has been synced.",
  "apiKeyBanner.text": "AI features require a Gemini API Key.",
  "apiKeyBanner.button": "Enter Key",
  "settings.apiKeyTest.status.testing": "Testing API key...",
  "settings.apiKeyTest.status.success": "API key verified successfully!",
  "settings.apiKeyTest.status.error.generic": "Verification failed: {message}",
  "settings.apiKeyTest.status.error.invalidKey.start": "Invalid API key. Please check your key or generate a new one at ",
  "settings.apiKeyTest.status.error.invalidKey.linkText": "Google AI Studio",
  "settings.apiKeyTest.status.error.invalidKey.end": ".",
  "settings.apiKeyTest.placeholder": "Enter your Gemini API Key",
  "settings.apiKeyTest.button": "Test & Save",
  "apiKeyModal.title": "Welcome to Food Memory Tracker",
  "apiKeyModal.description": "To unlock AI features like photo analysis and smart search, please provide your Google Gemini API key. Your key is stored locally on your device.",
  "apiKeyModal.button.testAndSave": "Verify & Start",
  "apiKeyModal.link.whereToGet": "Get a free API key from Google AI Studio",
};

const deTranslations = {
  "nav.myItems": "Meine Einträge",
  "nav.family": "Familie",
  "header.title": "Lebensmittel-Tracker",
  "header.searchPlaceholder": "Suche nach Name, Notizen, Tags...",
  "header.filter.button": "Filter",
  "header.filter.all": "Alle Produkte",
  "header.filter.liked": "Gemocht (4-5 Sterne)",
  "header.filter.disliked": "Nicht gemocht (1-2 Sterne)",
  "header.filter.type.all": "Alle Arten",
  "header.filter.type.products": "Produkte",
  "header.filter.type.dishes": "Gerichte",
  "header.filter.type.drugstore": "Drogerie",
  "header.filter.active.search": "Suche: \"{term}\"",
  "header.filter.active.aiSearch": "KI: \"{term}\"",
  "header.filter.active.type.product": "Art: Produkte",
  "header.filter.active.type.dish": "Art: Gerichte",
  "header.filter.active.type.drugstore": "Art: Drogerie",
  "header.filter.active.rating.liked": "Gemochte Artikel",
  "header.filter.active.rating.disliked": "Nicht gemochte Artikel",
  "header.filter.clearAll": "Alle Filter löschen",
  "header.sort.dateDesc": "Datum (Neueste zuerst)",
  "header.sort.dateAsc": "Datum (Älteste zuerst)",
  "header.sort.ratingDesc": "Bewertung (Hoch zu Niedrig)",
  "header.sort.ratingAsc": "Bewertung (Niedrig zu Hoch)",
  "header.sort.nameAsc": "Name (A-Z)",
  "header.sort.nameDesc": "Name (Z-A)",
  "header.shoppingListAria": "Einkaufsliste öffnen",
  "footer.text": "Nie wieder einen Favoriten vergessen.",
  "filterPanel.title": "Filtern & Sortieren",
  "filterPanel.search": "Suchbegriff",
  "filterPanel.aiSearchTitle": "KI-gestützte Suche",
  "filterPanel.filterByType": "Nach Typ filtern",
  "filterPanel.filterByRating": "Nach Bewertung filtern",
  "filterPanel.sortBy": "Sortieren nach",
  "filterPanel.reset": "Filter zurücksetzen",
  "filterPanel.apply": "Anwenden",
  "dashboard.title": "Dashboard",
  "dashboard.welcome": "Willkommen zurück!",
  "dashboard.recentlyAdded": "Kürzlich hinzugefügt",
  "dashboard.topRated": "Deine Bestbewerteten",
  "dashboard.viewAll": "Alle Einträge ansehen",
  "dashboard.empty.title": "Deine kulinarische Reise beginnt hier!",
  "dashboard.empty.description": "Füge dein erstes Produkt oder Gericht hinzu, um dein persönliches Dashboard zu sehen.",
  "family.title": "Familienfavoriten",
  "family.loading": "Lade Familienfavoriten...",
  "family.empty.title": "Noch keine Familienfavoriten!",
  "family.empty.description": "Wenn du oder jemand in deinem Haushalt einen Eintrag hinzufügt und als Favorit markiert, erscheint er hier.",
  "family.noHousehold.title": "Tritt einem Haushalt bei",
  "family.noHousehold.description": "Erstelle oder trete einem Haushalt in den Einstellungen bei, um Einträge und Einkaufslisten mit deiner Familie zu teilen.",
  "conversationalSearch.placeholder": "Frag nach deinem Essen... (z.B. ein glutenfreier Snack, den ich mochte)",
  "conversationalSearch.tooltip": "Suche mit KI",
  "conversationalSearch.buttonAria": "Suche mit KI",
  "conversationalSearch.searching": "KI denkt nach...",
  "conversationalSearch.error": "KI-Suche fehlgeschlagen. Bitte versuche eine andere Anfrage.",
  "conversationalSearch.resultsTitle": "KI-Suchergebnisse",
  "conversationalSearch.clear": "KI-Suche löschen",
  "shoppingList.title": "Gemeinsame Liste",
  "shoppingList.empty": "Diese Liste ist leer. Füge Produkte von ihren Karten hinzu, um zu beginnen.",
  "shoppingList.clear": "Erledigte löschen",
  "shoppingList.addAria": "{name} zur Einkaufsliste hinzufügen",
  "shoppingList.removeAria": "{name} von der Einkaufsliste entfernen",
  "shoppingList.toggleDetailsAria": "Details umschalten",
  "shoppingList.addedToast": "{name} zur Liste hinzugefügt.",
  "shoppingList.addedAnotherToast": "Ein weiteres {name} zur Liste hinzugefügt.",
  "shoppingList.quantity": "Menge",
  "shoppingList.uncategorized": "Nicht kategorisiert",
  "shoppingList.defaultListName": "Haushaltseinkäufe",
  "shoppingList.joinSuccess": "Erfolgreich dem Haushalt beigetreten: {householdName}!",
  "shoppingList.selectListAria": "Wähle eine gemeinsame Liste",
  "shoppingList.newListButton": "Neue Liste erstellen",
  "shoppingList.newListPlaceholder": "Name der neuen Liste...",
  "shoppingList.createButton": "Erstellen",
  "shoppingList.share.inviteButton": "Mitglieder einladen",
  "shoppingList.share.linkCopied": "Einladungslink kopiert!",
  "shoppingList.share.copyFailed": "Konnte Link nicht kopieren. Bitte manuell kopieren.",
  "shoppingList.collaboration.members": "Mitglieder",
  "shoppingList.collaboration.you": "Du",
  "shoppingList.collaboration.someone": "Jemand",
  "shoppingList.collaboration.addedBy": "Hinzugefügt von {name}",
  "shoppingList.collaboration.checkedBy": "Abgehakt von {name}",
  "shoppingList.manage.buttonTitle": "Liste verwalten",
  "shoppingList.delete.button": "Liste löschen",
  "shoppingList.delete.confirm": "Bist du sicher, dass du die Liste \"{listName}\" dauerhaft löschen möchtest? Dies kann nicht rückgängig gemacht werden.",
  "shoppingList.mode.startShopping": "Einkauf starten",
  "shoppingList.mode.done": "Fertig",
  "shoppingList.mode.completed": "Erledigt",
  "shoppingList.mode.clearCompleted": "{count} Erledigte löschen",
  "shoppingList.quickAdd.placeholder": "Smart Add (z.B. Milch, 2 Eier, Äpfel)",
  "shoppingList.quickAdd.processing": "Verarbeite...",
  "form.addNewButton": "Neuer Eintrag",
  "form.editTitle": "Eintrag bearbeiten",
  "form.placeholder.name": "Produktname",
  "form.placeholder.dishName": "Gerichtname (z.B. Spaghetti Carbonara)",
  "form.placeholder.restaurant": "Restaurantname",
  "form.placeholder.cuisine": "Küchenart (z.B. Italienisch)",
  "form.placeholder.price": "Preis",
  "form.placeholder.purchaseLocation": "Geschäft / Ort (z.B. Lidl, Aldi - mit Komma trennen)",
  "form.label.rating": "Bewertung:",
  "form.aria.rate": "Bewerte mit {star} Stern",
  "form.aria.ratePlural": "Bewerte mit {star} Sternen",
  "form.placeholder.notes": "Notizen (z.B. Geschmack, wo gekauft)",
  "form.placeholder.tags": "Tags (mit Komma trennen)",
  "form.label.nutriScore": "Nutri-Score:",
  "form.aria.selectNutriScore": "Wähle Nutri-Score {score}",
  "form.label.selectRestaurant": "Oder wähle ein Restaurant in der Nähe:",
  "form.placeholder.selectRestaurant": "-- Wähle ein Restaurant --",
  "form.error.nameAndRating": "Bitte gib einen Namen und eine Bewertung an.",
  "form.error.genericAiError": "Konnte Bild nicht mit KI analysieren. Bitte versuche es erneut oder gib Details manuell ein.",
  "form.error.ingredientsAiError": "Konnte Zutatenliste nicht analysieren.",
  "form.error.barcodeError": "Konnte Produktdaten für diesen Barcode nicht abrufen. Das Produkt ist möglicherweise nicht in der Datenbank.",
  "form.error.offSearchDisabled": "Datenbanksuche ist in den Einstellungen deaktiviert. Aktiviere sie, um diese Funktion zu nutzen.",
  "form.error.geolocationUnsupported": "Geolokalisierung wird von deinem Browser nicht unterstützt.",
  "form.error.geolocationPermission": "Konnte Standort nicht abrufen. Bitte aktiviere Standortdienste.",
  "form.error.findRestaurants": "Konnte keine Restaurants in der Nähe finden. Bitte versuche es erneut oder gib es manuell ein.",
  "form.button.cancel": "Abbrechen",
  "form.button.save": "Speichern",
  "form.button.update": "Aktualisieren",
  "form.button.scanIngredients": "Zutaten scannen",
  "form.button.scanBarcode": "Barcode scannen",
  "form.button.dictate": "Diktieren",
  "form.button.takePhoto": "Foto aufnehmen",
  "form.button.findNearby.aria": "Finde Restaurants in der Nähe",
  "form.findRestaurants.loading": "Suche Restaurants in der Nähe...",
  "form.image.removeAria": "Bild entfernen",
  "form.image.placeholder": "Scanne ein Produkt oder lade ein Bild hoch",
  "form.button.scanNew": "Foto scannen",
  "form.button.upload": "Hochladen",
  "form.aiProgress.readingName": "Lese Produktnamen...",
  "form.aiProgress.findingScore": "Finde Nutri-Score...",
  "form.aiProgress.generatingTags": "Generiere Tags...",
  "form.aiProgress.searchingDatabase": "Suche in Datenbank...",
  "form.aiProgress.locatingProduct": "Lokalisiere Produkt im Bild...",
  "form.aiProgress.complete": "Analyse abgeschlossen!",
  "form.ingredients.title": "Zutaten & Ernährung",
  "form.ingredients.loading": "Scanne Zutatenliste...",
  "form.ingredients.ingredientsList": "Zutaten",
  "form.ingredients.placeholder": "Keine Zutaten gefunden. Scanne den Barcode oder die Liste.",
  "form.allergens.title": "Allergene",
  "form.dietary.title": "Ernährungsinformationen",
  "form.attributes.title": "Produkteigenschaften",
  "form.dietary.lactoseFree": "Laktosefrei",
  "form.dietary.vegan": "Vegan",
  "form.dietary.glutenFree": "Glutenfrei",
  "form.category.title": "Kategorie",
  "form.familyFavorite.title": "Als Familienfavorit markieren",
  "form.familyFavorite.description": "Macht diesen Eintrag für alle in deinem Haushalt sichtbar.",
  "list.empty.title": "Deine Liste ist leer!",
  "list.empty.description": "Füge einen Eintrag über das Formular hinzu, um deine Vorlieben zu tracken.",
  "list.resultsFor": "Ergebnisse für \"{searchTerm}\"",
  "card.deleteAria": "Lösche {name}",
  "card.editAria": "Bearbeite {name}",
  "card.shareAria": "Teile {name}",
  "card.lactoseFreeTooltip": "Laktosefrei",
  "card.veganTooltip": "Vegan",
  "card.glutenFreeTooltip": "Glutenfrei",
  "card.productTooltip": "Verpacktes Produkt",
  "card.dishTooltip": "Restaurantgericht",
  "card.drugstoreTooltip": "Drogerieartikel",
  "card.familyFavoriteTooltip": "Familienfavorit",
  "card.privateTooltip": "Privater Eintrag",
  "card.dishAt": "bei {restaurant}",
  "share.title": "Schau dir dieses Produkt an: {name}",
  "share.text": "Ich habe \"{name}\" mit {rating}/5 Sternen bewertet. Sieh dir meine Meinung in der Food Memory Tracker App an!",
  "share.text_unrated": "Schau dir \"{name}\" in der Food Memory Tracker App an!",
  "camera.title": "Foto aufnehmen",
  "camera.error": "Konnte nicht auf die Kamera zugreifen. Bitte prüfe die Berechtigungen.",
  "camera.error.permission": "Kamerazugriff verweigert. Bitte prüfe deine Browser-Einstellungen.",
  "camera.captureButton": "Foto aufnehmen",
  "barcodeScanner.title": "Barcode scannen",
  "barcodeScanner.description": "Richte die Kamera auf den Barcode.",
  "barcodeScanner.error.permission": "Kamerazugriff verweigert. Bitte erlaube den Zugriff.",
  "cropper.title": "Ausschnitt anpassen",
  "cropper.description": "Passe den KI-Vorschlag an oder brich ab für das ganze Bild.",
  "cropper.button.cancel": "Abbrechen (Vollbild)",
  "cropper.button.confirm": "Bestätigen",
  "modal.image.closeAria": "Bildansicht schließen",
  "modal.duplicate.title": "Mögliches Duplikat",
  "modal.duplicate.description": "Ein Eintrag namens \"{itemName}\" existiert bereits.",
  "modal.duplicate.button.goBack": "Zurück & Bearbeiten",
  "modal.duplicate.button.addAnyway": "Trotzdem hinzufügen",
  "modal.shared.title": "Geteilter Eintrag",
  "modal.shared.description": "Jemand hat diesen Eintrag mit dir geteilt. Möchtest du ihn hinzufügen?",
  "modal.shared.addToList": "Zu meiner Liste",
  "modal.shared.close": "Schließen",
  "modal.shared.summaryNotice": "Hinweis: Dies ist eine Zusammenfassung. Manche Details fehlen möglicherweise.",
  "modal.itemType.title": "Was möchtest du hinzufügen?",
  "modal.itemType.product": "Verpacktes Produkt",
  "modal.itemType.dish": "Restaurantgericht",
  "modal.itemType.drugstore": "Drogerieartikel",
  "speechModal.title": "Namen diktieren",
  "speechModal.description": "Sprich jetzt, der Name wird transkribiert.",
  "speechModal.listening": "Zuhören...",
  "settings.title": "Einstellungen",
  "settings.closeAria": "Einstellungen schließen",
  "settings.theme.title": "Design",
  "settings.theme.light": "Hell",
  "settings.theme.dark": "Dunkel",
  "settings.theme.system": "System",
  "settings.language.title": "Sprache",
  "settings.ai.title": "KI-Funktionen",
  "settings.ai.description": "Aktiviere KI-Analyse für Fotos.",
  "settings.barcodeScanner.title": "Barcode Scanner",
  "settings.barcodeScanner.description": "Aktiviere den Barcode-Scanner.",
  "settings.offSearch.title": "Datenbanksuche",
  "settings.offSearch.description": "Aktiviere automatische Suche in Open Food Facts.",
  "settings.shops.title": "Bevorzugte Geschäfte",
  "settings.shops.description": "Füge deine Stammläden hinzu. Diese erscheinen als Schnellwahl beim Hinzufügen von Einträgen.",
  "settings.shops.placeholder": "Ladenname hinzufügen...",
  "settings.button.done": "Fertig",
  "settings.session.title": "Konto",
  "settings.session.loggedInAs": "Angemeldet als:",
  "settings.session.logout": "Abmelden",
  "settings.household.title": "Haushalt",
  "settings.household.create.button": "Haushalt erstellen",
  "settings.household.create.placeholder": "Haushaltsname (z.B. Familie Müller)",
  "settings.household.join.description": "Frage ein Mitglied nach einem Einladungslink.",
  "settings.household.manage.members": "Mitglieder",
  "settings.household.manage.activeMembers": "Aktive Mitglieder:",
  "settings.household.manage.invite": "Mitglieder einladen",
  "settings.household.manage.leave": "Haushalt verlassen",
  "settings.household.manage.leaveConfirm": "Willst du diesen Haushalt wirklich verlassen?",
  "settings.household.manage.delete": "Haushalt löschen",
  "settings.household.manage.deleteConfirm": "Bist du sicher? Dies löscht alle geteilten Daten. Unwiderruflich.",
  "settings.household.manage.linkCopied": "Link kopiert!",
  "household.error.rls.insert": "Fehler: Datenbankregeln verhindern Erstellung. Prüfe Supabase Policies.",
  "household.error.generic": "Fehler beim Erstellen: {message}",
  "settings.troubleshoot.title": "Datenbank Reparatur",
  "settings.troubleshoot.description": "Wenn Familienmitglieder keine Artikel sehen, führe dieses Skript im Supabase SQL Editor aus.",
  "settings.troubleshoot.description_category": "Wenn der Fehler 'Could not find the category column' auftritt, führe dieses Skript aus.",
  "settings.troubleshoot.button": "Reparatur-Skript anzeigen",
  "settings.troubleshoot.sqlInstructions": "Kopiere diesen Code und führe ihn im Supabase SQL Editor aus.",
  "auth.emailPlaceholder": "E-Mail",
  "auth.passwordPlaceholder": "Passwort",
  "auth.signIn": "Anmelden",
  "auth.signUp": "Registrieren",
  "auth.magicLink": "Magic Link senden",
  "auth.magicLinkSuccess": "Prüfe deine E-Mails für den Link!",
  "auth.toggle.signUp": "Kein Konto? Registrieren",
  "auth.toggle.signIn": "Hast du ein Konto? Anmelden",
  "auth.error.generic": "Authentifizierung fehlgeschlagen.",
  "allergen.gluten": "Enthält Gluten",
  "allergen.dairy": "Enthält Milch",
  "allergen.peanuts": "Enthält Erdnüsse",
  "allergen.tree_nuts": "Enthält Schalenfrüchte",
  "allergen.soy": "Enthält Soja",
  "allergen.eggs": "Enthält Eier",
  "allergen.fish": "Enthält Fisch",
  "allergen.shellfish": "Enthält Schalentiere",
  "category.produce": "Obst & Gemüse",
  "category.bakery": "Backwaren",
  "category.meat_fish": "Fleisch & Fisch",
  "category.dairy_eggs": "Milch & Eier",
  "category.pantry": "Vorratsschrank",
  "category.frozen": "Tiefkühl",
  "category.snacks": "Süßwaren & Snacks",
  "category.beverages": "Getränke",
  "category.household": "Haushalt",
  "category.personal_care": "Drogerie & Pflege",
  "category.restaurant_food": "Restaurant",
  "category.pet_food": "Tiernahrung",
  "category.other": "Sonstiges",
  "detail.notesTitle": "Notizen",
  "detail.tagsTitle": "Tags",
  "detail.ingredientsTitle": "Zutaten",
  "detail.allergensTitle": "Allergene",
  "detail.dietaryTitle": "Ernährung",
  "detail.status": "Status",
  "detail.statusFamilyFavorite": "Familienfavorit",
  "detail.statusPrivate": "Privat",
  "offline.message": "Du bist offline. Änderungen werden gespeichert und später synchronisiert.",
  "offline.syncComplete": "Wieder online! Daten wurden synchronisiert.",
  "apiKeyBanner.text": "KI-Funktionen benötigen einen Gemini API Key.",
  "apiKeyBanner.button": "Key eingeben",
  "settings.apiKeyTest.status.testing": "Teste API Key...",
  "settings.apiKeyTest.status.success": "API Key erfolgreich verifiziert!",
  "settings.apiKeyTest.status.error.generic": "Verifizierung fehlgeschlagen: {message}",
  "settings.apiKeyTest.status.error.invalidKey.start": "Ungültiger API Key. Bitte prüfe ihn oder erstelle einen neuen im ",
  "settings.apiKeyTest.status.error.invalidKey.linkText": "Google AI Studio",
  "settings.apiKeyTest.status.error.invalidKey.end": ".",
  "settings.apiKeyTest.placeholder": "Gib deinen Gemini API Key ein",
  "settings.apiKeyTest.button": "Testen & Speichern",
  "apiKeyModal.title": "Willkommen beim Food Memory Tracker",
  "apiKeyModal.description": "Um KI-Funktionen wie Fotoanalyse und intelligente Suche freizuschalten, gib bitte deinen Google Gemini API Key ein. Dein Schlüssel wird lokal auf deinem Gerät gespeichert.",
  "apiKeyModal.button.testAndSave": "Verifizieren & Starten",
  "apiKeyModal.link.whereToGet": "Hol dir einen kostenlosen API Key vom Google AI Studio",
};

// --- Context Setup ---
interface I18nContextType {
  language: 'en' | 'de';
  setLanguage: (lang: 'en' | 'de') => void;
  t: (key: string, params?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguageState] = useState<'en' | 'de'>(() => {
    const saved = localStorage.getItem('language') as 'en' | 'de';
    return saved || (navigator.language.startsWith('de') ? 'de' : 'en');
  });

  const setLanguage = (lang: 'en' | 'de') => {
    setLanguageState(lang);
    localStorage.setItem('language', lang);
  };

  const translations = useMemo(() => {
    return language === 'de' ? deTranslations : enTranslations;
  }, [language]);

  const t = useCallback((key: string, params?: Record<string, string | number>) => {
    let text = (translations as any)[key] || key;
    if (params) {
      Object.entries(params).forEach(([k, v]) => {
        text = text.replace(`{${k}}`, String(v));
      });
    }
    return text;
  }, [translations]);

  const value = { language, setLanguage, t };

  return React.createElement(I18nContext.Provider, { value }, children);
};

export const useTranslation = (): I18nContextType => {
  const context = useContext(I18nContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within an I18nProvider');
  }
  return context;
};
