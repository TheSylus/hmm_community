import React, { createContext, useState, useContext, ReactNode, useCallback, useEffect } from 'react';

type Language = 'en' | 'de';

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, options?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

const en = {
    "header.title": "Food Memory Tracker",
    "header.view.dashboard": "Dashboard",
    "header.view.list": "All Items",
    "header.view.discover": "Discover",
    "header.view.groups": "Groups",
    "header.button.filter": "Filter",
    "header.button.settings": "Settings",
    "header.button.shoppingList": "Shopping List",
    "bottomNav.dashboard": "Dashboard",
    "bottomNav.list": "Items",
    "bottomNav.discover": "Discover",
    "bottomNav.groups": "Groups",
    "form.editTitle": "Edit Entry",
    "form.addNewButton": "Add New Entry",
    "list.empty.title": "No Entries Yet",
    "list.empty.description": "Click 'Add New Entry' to start tracking your food memories!",
    "camera.error.permission": "Camera permission was denied. Please enable it in your browser settings.",
    "camera.error": "Could not access camera.",
    "camera.title": "Capture Image",
    "camera.captureButton": "Capture",
    "cropper.title": "Crop Image",
    "cropper.description": "Adjust the selection to crop the image.",
    "cropper.button.cancel": "Cancel",
    "cropper.button.confirm": "Confirm",
    "modal.image.closeAria": "Close image viewer",
    "modal.duplicate.title": "Duplicate Item?",
    "modal.duplicate.description": "You've already logged an item named \"{itemName}\". Do you want to add another one?",
    "modal.duplicate.button.goBack": "Go Back",
    "modal.duplicate.button.addAnyway": "Add Anyway",
    "settings.title": "Settings",
    "settings.closeAria": "Close settings",
    "settings.language.title": "Language",
    "settings.theme.title": "Theme",
    "settings.theme.light": "Light",
    "settings.theme.dark": "Dark",
    "settings.theme.system": "System",
    "settings.offSearch.title": "Food Database Search",
    "settings.offSearch.description": "Enhance product data by searching the Open Food Facts database.",
    "settings.barcodeScanner.title": "Barcode Scanner",
    "settings.barcodeScanner.description": "Enable or disable the barcode scanner button in the form.",
    "settings.ai.title": "AI Features",
    "settings.ai.description": "Enable AI-powered image analysis and conversational search. Requires a Gemini API Key.",
    "settings.session.title": "Session",
    "settings.session.loggedInAs": "Logged in as:",
    "settings.session.logout": "Log Out",
    "settings.button.done": "Done",
    "settings.apiKeyTest.placeholder": "Enter your Gemini API Key...",
    "settings.apiKeyTest.button": "Test & Save Key",
    "settings.apiKeyTest.status.testing": "Testing key...",
    "settings.apiKeyTest.status.success": "API Key is valid and has been saved!",
    "settings.apiKeyTest.status.error.invalidKey.start": "API key not valid. Please ",
    "settings.apiKeyTest.status.error.invalidKey.linkText": "get a valid key from Google AI Studio",
    "settings.apiKeyTest.status.error.invalidKey.end": ".",
    "settings.apiKeyTest.status.error.generic": "Test failed: {message}",
    "apiKeyModal.title": "Enter Your Gemini API Key",
    "apiKeyModal.description": "To use the AI-powered features of this app, you need to provide your own Google Gemini API key. Your key is stored securely in your browser's local storage and is never sent to our servers.",
    "apiKeyModal.button.testAndSave": "Test & Save Key",
    "apiKeyModal.link.whereToGet": "Where can I get an API key?",
    "allergen.gluten": "Gluten",
    "allergen.dairy": "Dairy",
    "allergen.peanuts": "Peanuts",
    "allergen.tree_nuts": "Tree Nuts",
    "allergen.soy": "Soy",
    "allergen.eggs": "Eggs",
    "allergen.fish": "Fish",
    "allergen.shellfish": "Shellfish",
    "barcodeScanner.error.permission": "Camera access is required for barcode scanning. Please grant permission.",
    "barcodeScanner.title": "Scan Barcode",
    "barcodeScanner.description": "Center the barcode in the frame.",
    "apiKeyBanner.text": "Unlock AI features! Add your Gemini API key to automatically analyze food images.",
    "apiKeyBanner.button": "Add API Key",
    "card.lactoseFreeTooltip": "Lactose-Free",
    "card.veganTooltip": "Vegan",
    "card.glutenFreeTooltip": "Gluten-Free",
    "card.dishAt": "at {restaurant}",
    "card.addToShoppingListTooltip": "Add to Shopping List",
    "speechModal.title": "Dictate Product Name",
    "speechModal.description": "Start speaking and we'll transcribe the name for you.",
    "speechModal.listening": "Listening...",
    "conversationalSearch.placeholder": "Search with AI (e.g., 'healthy snacks')",
    "conversationalSearch.buttonAria": "Perform AI search",
    "conversationalSearch.tooltip": "Use AI to search your food items",
    "dashboard.empty.title": "Welcome to Your Food Journal!",
    "dashboard.empty.description": "This is where you'll see your recent and top-rated food memories. Get started by adding your first entry.",
    "dashboard.welcome": "Your Food Dashboard",
    "dashboard.recentlyAdded": "Recently Added",
    "dashboard.viewAll": "View All",
    "dashboard.topRated": "Top Rated",
    "filterPanel.title": "Filter & Sort",
    "filterPanel.aiSearchTitle": "Conversational Search",
    "filterPanel.search": "Search by name, notes, etc.",
    "filterPanel.filterByType": "Filter by Type",
    "filterPanel.filterByRating": "Filter by Rating",
    "filterPanel.sortBy": "Sort By",
    "filterPanel.reset": "Reset",
    "filterPanel.apply": "Apply",
    "header.searchPlaceholder": "Search...",
    "header.filter.type.all": "All Types",
    "header.filter.type.products": "Products",
    "header.filter.type.dishes": "Dishes",
    "header.filter.all": "All Ratings",
    "header.filter.liked": "Liked (4+ Stars)",
    "header.filter.disliked": "Disliked (1-2 Stars)",
    "header.sort.dateDesc": "Date (Newest)",
    "header.sort.dateAsc": "Date (Oldest)",
    "header.sort.ratingDesc": "Rating (High-Low)",
    "header.sort.ratingAsc": "Rating (Low-High)",
    "header.sort.nameAsc": "Name (A-Z)",
    "header.sort.nameDesc": "Name (Z-A)",
    "auth.emailPlaceholder": "Email",
    "auth.passwordPlaceholder": "Password",
    "auth.magicLinkSuccess": "Check your email for the confirmation link!",
    "auth.signUp": "Sign Up",
    "auth.signIn": "Sign In",
    "auth.toggle.signIn": "Already have an account? Sign In",
    "auth.toggle.signUp": "Don't have an account? Sign Up",
    "offline.message": "You are currently offline. Some features may be limited and changes will be synced when you're back online.",
    "discover.loading": "Loading community entries...",
    "discover.title": "Discover",
    "discover.empty.title": "Nothing to Discover Yet",
    "discover.empty.description": "Be the first to share a food memory with the community!",
    "groups.title": "Your Groups",
    "groups.newListPlaceholder": "New group name...",
    "groups.createButton": "Create",
    "groups.empty": "You are not a part of any groups yet. Create one to get started!",
    "groups.members": "{count, plural, =0 {0 members} =1 {1 member} other {# members}}",
    "form.error.geolocationUnsupported": "Geolocation is not supported by your browser.",
    "form.error.findRestaurants": "Could not find nearby restaurants.",
    "form.error.geolocationPermission": "Permission to access location was denied. Please enable it in your browser settings to find nearby restaurants.",
    "form.findRestaurants.loading": "Finding nearby restaurants...",
    "form.label.selectRestaurant": "Or select from nearby:",
    "form.placeholder.selectRestaurant": "Select a restaurant...",
    "form.button.findNearby.aria": "Find nearby restaurants",
    "form.error.offSearchDisabled": "Open Food Facts search is disabled in settings.",
    "form.error.barcodeError": "Could not find product for this barcode.",
    "form.aiProgress.readingName": "Analyzing image for product name...",
    "form.aiProgress.findingScore": "Looking for Nutri-Score...",
    "form.aiProgress.generatingTags": "Generating relevant tags...",
    "form.aiProgress.searchingDatabase": "Cross-referencing food database...",
    "form.aiProgress.locatingProduct": "Locating product in image...",
    "form.aiProgress.complete": "Analysis complete!",
    "form.error.genericAiError": "Could not analyze image with AI.",
    "form.error.ingredientsAiError": "Could not analyze ingredients with AI.",
    "form.error.nameAndRating": "Please provide a name and a rating.",
    "form.image.removeAria": "Remove image",
    "form.placeholder.name": "Product Name (e.g., Organic Whole Milk)",
    "form.placeholder.dishName": "Dish Name (e.g., Margherita Pizza)",
    "form.placeholder.restaurant": "Restaurant Name",
    "form.placeholder.cuisine": "Cuisine Type (e.g., Italian)",
    "form.placeholder.price": "Price",
    "form.label.rating": "Rating",
    "form.aria.rate": "Rate {star} star",
    "form.aria.ratePlural": "Rate {star} stars",
    "form.placeholder.notes": "Notes (e.g., taste, occasion, memories...)",
    "form.placeholder.tags": "Tags (comma-separated, e.g., snack, sweet, treat)",
    "form.placeholder.purchaseLocation": "Where did you get it? (e.g., Whole Foods)",
    "form.label.nutriScore": "Nutri-Score",
    "form.aria.selectNutriScore": "Select Nutri-Score {score}",
    "form.ingredients.title": "Ingredients & Dietary",
    "form.button.scanIngredients": "Scan Ingredients",
    "form.ingredients.loading": "Analyzing ingredients...",
    "form.dietary.title": "Dietary Flags",
    "form.dietary.lactoseFree": "Lactose-Free",
    "form.dietary.vegan": "Vegan",
    "form.dietary.glutenFree": "Gluten-Free",
    "form.allergens.title": "Potential Allergens",
    "form.ingredients.ingredientsList": "Ingredients",
    "form.ingredients.placeholder": "No ingredients data. Use the 'Scan Ingredients' button if you have an image of the list.",
    "form.share.title": "Sharing Options",
    "form.share.private": "Private",
    "form.share.privateDesc": "Only you can see this entry.",
    "form.share.community": "Share with Community",
    "form.share.communityDesc": "Make this entry visible to everyone in the Discover tab.",
    "form.share.group": "Share with Group",
    "form.share.groupDesc": "Share this with members of a specific shopping list.",
    "form.share.selectGroup": "Select a group...",
    "form.button.cancel": "Cancel",
    "form.button.update": "Update Entry",
    "form.button.save": "Save Entry",
    "form.button.scanBarcode": "Scan Code",
    "form.button.scanNew": "Scan Product",
    "form.button.takePhoto": "Take Photo",
    "form.button.upload": "Upload",
    "form.button.dictate": "Dictate",
    "detail.notesTitle": "Notes",
    "detail.tagsTitle": "Tags",
    "detail.dietaryTitle": "Dietary Information",
    "detail.allergensTitle": "Potential Allergens",
    "detail.ingredientsTitle": "Ingredients",
    "detail.status": "Status",
    "detail.statusPublic": "Public",
    "detail.statusPrivate": "Private",
    "addToListModal.title": "Add '{itemName}' to a list",
    "addToListModal.quantity": "Quantity",
    "addToListModal.selectList": "Select a list",
    "addToListModal.noLists": "You don't have any shopping lists yet. Create one in the Groups tab.",
    "addToListModal.button.add": "Add to List",
    "addToListModal.button.cancel": "Cancel",
    "toast.addedToList": "'{itemName}' added to {listName}.",
    "toast.noShoppingLists": "You don't have any shopping lists yet. Create one in the Groups tab to get started!",
    "shoppingMode.title": "Shopping Mode",
    "shoppingMode.empty": "This shopping list is empty.",
    "shoppingMode.completedItems": "Completed Items",
    "shoppingMode.quickAddPlaceholder": "Add item...",
    "shoppingMode.quickAddButton": "Add",
    "shoppingMode.menu.manageMembers": "Manage Members",
    "shoppingMode.menu.leaveList": "Leave List",
    "shoppingMode.menu.deleteList": "Delete List"
};

const de: Record<string, string> = {
    "header.title": "Food Memory Tracker",
    "header.view.dashboard": "Dashboard",
    "header.view.list": "Alle Artikel",
    "header.view.discover": "Entdecken",
    "header.view.groups": "Gruppen",
    "header.button.filter": "Filter",
    "header.button.settings": "Einstellungen",
    "header.button.shoppingList": "Einkaufsliste",
    "bottomNav.dashboard": "Dashboard",
    "bottomNav.list": "Artikel",
    "bottomNav.discover": "Entdecken",
    "bottomNav.groups": "Gruppen",
    "form.editTitle": "Eintrag bearbeiten",
    "form.addNewButton": "Neuen Eintrag hinzufügen",
    "list.empty.title": "Noch keine Einträge",
    "list.empty.description": "Klicken Sie auf 'Neuen Eintrag hinzufügen', um Ihre Essenserinnerungen festzuhalten!",
    "camera.error.permission": "Kamerazugriff verweigert. Bitte in den Browsereinstellungen aktivieren.",
    "camera.error": "Konnte auf Kamera nicht zugreifen.",
    "camera.title": "Bild aufnehmen",
    "camera.captureButton": "Aufnehmen",
    "cropper.title": "Bild zuschneiden",
    "cropper.description": "Passen Sie die Auswahl an, um das Bild zuzuschneiden.",
    "cropper.button.cancel": "Abbrechen",
    "cropper.button.confirm": "Bestätigen",
    "modal.image.closeAria": "Bildansicht schließen",
    "modal.duplicate.title": "Doppelter Artikel?",
    "modal.duplicate.description": "Sie haben bereits einen Artikel namens \"{itemName}\" erfasst. Möchten Sie einen weiteren hinzufügen?",
    "modal.duplicate.button.goBack": "Zurück",
    "modal.duplicate.button.addAnyway": "Trotzdem hinzufügen",
    "settings.title": "Einstellungen",
    "settings.closeAria": "Einstellungen schließen",
    "settings.language.title": "Sprache",
    "settings.theme.title": "Design",
    "settings.theme.light": "Hell",
    "settings.theme.dark": "Dunkel",
    "settings.theme.system": "System",
    "settings.offSearch.title": "Lebensmittel-Datenbanksuche",
    "settings.offSearch.description": "Produktdaten durch Suche in der Open Food Facts-Datenbank verbessern.",
    "settings.barcodeScanner.title": "Barcode-Scanner",
    "settings.barcodeScanner.description": "Aktiviert oder deaktiviert den Barcode-Scanner-Button im Formular.",
    "settings.ai.title": "KI-Funktionen",
    "settings.ai.description": "KI-gestützte Bildanalyse und Konversationssuche aktivieren. Benötigt einen Gemini API-Schlüssel.",
    "settings.session.title": "Sitzung",
    "settings.session.loggedInAs": "Angemeldet als:",
    "settings.session.logout": "Abmelden",
    "settings.button.done": "Fertig",
    "settings.apiKeyTest.placeholder": "Geben Sie Ihren Gemini API-Schlüssel ein...",
    "settings.apiKeyTest.button": "Schlüssel testen & speichern",
    "settings.apiKeyTest.status.testing": "Schlüssel wird getestet...",
    "settings.apiKeyTest.status.success": "API-Schlüssel ist gültig und wurde gespeichert!",
    "settings.apiKeyTest.status.error.invalidKey.start": "API-Schlüssel ungültig. Bitte ",
    "settings.apiKeyTest.status.error.invalidKey.linkText": "holen Sie sich einen gültigen Schlüssel vom Google AI Studio",
    "settings.apiKeyTest.status.error.invalidKey.end": ".",
    "settings.apiKeyTest.status.error.generic": "Test fehlgeschlagen: {message}",
    "apiKeyModal.title": "Geben Sie Ihren Gemini API-Schlüssel ein",
    "apiKeyModal.description": "Um die KI-gestützten Funktionen dieser App zu nutzen, müssen Sie Ihren eigenen Google Gemini API-Schlüssel angeben. Ihr Schlüssel wird sicher im lokalen Speicher Ihres Browsers gespeichert und niemals an unsere Server gesendet.",
    "apiKeyModal.button.testAndSave": "Schlüssel testen & speichern",
    "apiKeyModal.link.whereToGet": "Wo bekomme ich einen API-Schlüssel?",
    "allergen.gluten": "Gluten",
    "allergen.dairy": "Milchprodukte",
    "allergen.peanuts": "Erdnüsse",
    "allergen.tree_nuts": "Schalenfrüchte",
    "allergen.soy": "Soja",
    "allergen.eggs": "Eier",
    "allergen.fish": "Fisch",
    "allergen.shellfish": "Schalentiere",
    "barcodeScanner.error.permission": "Kamerazugriff für das Scannen von Barcodes erforderlich. Bitte erteilen Sie die Erlaubnis.",
    "barcodeScanner.title": "Barcode scannen",
    "barcodeScanner.description": "Zentrieren Sie den Barcode im Rahmen.",
    "apiKeyBanner.text": "Schalten Sie KI-Funktionen frei! Fügen Sie Ihren Gemini API-Schlüssel hinzu, um Lebensmittelbilder automatisch zu analysieren.",
    "apiKeyBanner.button": "API-Schlüssel hinzufügen",
    "card.lactoseFreeTooltip": "Laktosefrei",
    "card.veganTooltip": "Vegan",
    "card.glutenFreeTooltip": "Glutenfrei",
    "card.dishAt": "bei {restaurant}",
    "card.addToShoppingListTooltip": "Zur Einkaufsliste hinzufügen",
    "speechModal.title": "Produktname diktieren",
    "speechModal.description": "Sprechen Sie und wir schreiben den Namen für Sie auf.",
    "speechModal.listening": "Höre zu...",
    "conversationalSearch.placeholder": "Mit KI suchen (z.B. 'gesunde Snacks')",
    "conversationalSearch.buttonAria": "KI-Suche durchführen",
    "conversationalSearch.tooltip": "Nutzen Sie KI, um Ihre Lebensmittel zu durchsuchen",
    "dashboard.empty.title": "Willkommen bei Ihrem Food-Tagebuch!",
    "dashboard.empty.description": "Hier sehen Sie Ihre letzten und am besten bewerteten Essenserinnerungen. Legen Sie los, indem Sie Ihren ersten Eintrag hinzufügen.",
    "dashboard.welcome": "Ihr Food-Dashboard",
    "dashboard.recentlyAdded": "Zuletzt hinzugefügt",
    "dashboard.viewAll": "Alle ansehen",
    "dashboard.topRated": "Top bewertet",
    "filterPanel.title": "Filtern & Sortieren",
    "filterPanel.aiSearchTitle": "Konversationssuche",
    "filterPanel.search": "Suche nach Name, Notizen, etc.",
    "filterPanel.filterByType": "Nach Typ filtern",
    "filterPanel.filterByRating": "Nach Bewertung filtern",
    "filterPanel.sortBy": "Sortieren nach",
    "filterPanel.reset": "Zurücksetzen",
    "filterPanel.apply": "Anwenden",
    "header.searchPlaceholder": "Suchen...",
    "header.filter.type.all": "Alle Typen",
    "header.filter.type.products": "Produkte",
    "header.filter.type.dishes": "Gerichte",
    "header.filter.all": "Alle Bewertungen",
    "header.filter.liked": "Gut bewertet (4+ Sterne)",
    "header.filter.disliked": "Schlecht bewertet (1-2 Sterne)",
    "header.sort.dateDesc": "Datum (Neueste)",
    "header.sort.dateAsc": "Datum (Älteste)",
    "header.sort.ratingDesc": "Bewertung (Hoch-Niedrig)",
    "header.sort.ratingAsc": "Bewertung (Niedrig-Hoch)",
    "header.sort.nameAsc": "Name (A-Z)",
    "header.sort.nameDesc": "Name (Z-A)",
    "auth.emailPlaceholder": "E-Mail",
    "auth.passwordPlaceholder": "Passwort",
    "auth.magicLinkSuccess": "Überprüfen Sie Ihre E-Mails für den Bestätigungslink!",
    "auth.signUp": "Registrieren",
    "auth.signIn": "Anmelden",
    "auth.toggle.signIn": "Haben Sie bereits ein Konto? Anmelden",
    "auth.toggle.signUp": "Haben Sie noch kein Konto? Registrieren",
    "offline.message": "Sie sind derzeit offline. Einige Funktionen sind möglicherweise eingeschränkt und Änderungen werden synchronisiert, wenn Sie wieder online sind.",
    "discover.loading": "Lade Community-Einträge...",
    "discover.title": "Entdecken",
    "discover.empty.title": "Noch nichts zu entdecken",
    "discover.empty.description": "Seien Sie der Erste, der eine Essenserinnerung mit der Community teilt!",
    "groups.title": "Ihre Gruppen",
    "groups.newListPlaceholder": "Name der neuen Gruppe...",
    "groups.createButton": "Erstellen",
    "groups.empty": "Sie sind noch in keiner Gruppe. Erstellen Sie eine, um loszulegen!",
    "groups.members": "{count, plural, =0 {0 Mitglieder} =1 {1 Mitglied} other {# Mitglieder}}",
    "form.error.geolocationUnsupported": "Geolokalisierung wird von Ihrem Browser nicht unterstützt.",
    "form.error.findRestaurants": "Konnte keine Restaurants in der Nähe finden.",
    "form.error.geolocationPermission": "Zugriff auf den Standort wurde verweigert. Bitte aktivieren Sie ihn in Ihren Browsereinstellungen, um Restaurants in der Nähe zu finden.",
    "form.findRestaurants.loading": "Suche Restaurants in der Nähe...",
    "form.label.selectRestaurant": "Oder aus der Nähe auswählen:",
    "form.placeholder.selectRestaurant": "Restaurant auswählen...",
    "form.button.findNearby.aria": "Restaurants in der Nähe finden",
    "form.error.offSearchDisabled": "Open Food Facts-Suche ist in den Einstellungen deaktiviert.",
    "form.error.barcodeError": "Konnte kein Produkt für diesen Barcode finden.",
    "form.aiProgress.readingName": "Analysiere Bild für Produktnamen...",
    "form.aiProgress.findingScore": "Suche nach Nutri-Score...",
    "form.aiProgress.generatingTags": "Generiere relevante Tags...",
    "form.aiProgress.searchingDatabase": "Gleiche mit Lebensmittel-Datenbank ab...",
    "form.aiProgress.locatingProduct": "Lokalisiere Produkt im Bild...",
    "form.aiProgress.complete": "Analyse abgeschlossen!",
    "form.error.genericAiError": "Bild konnte mit KI nicht analysiert werden.",
    "form.error.ingredientsAiError": "Zutaten konnten mit KI nicht analysiert werden.",
    "form.error.nameAndRating": "Bitte geben Sie einen Namen und eine Bewertung an.",
    "form.image.removeAria": "Bild entfernen",
    "form.placeholder.name": "Produktname (z.B. Bio-Vollmilch)",
    "form.placeholder.dishName": "Gerichtsname (z.B. Pizza Margherita)",
    "form.placeholder.restaurant": "Restaurantname",
    "form.placeholder.cuisine": "Küchenart (z.B. Italienisch)",
    "form.placeholder.price": "Preis",
    "form.label.rating": "Bewertung",
    "form.aria.rate": "Bewerte {star} Stern",
    "form.aria.ratePlural": "Bewerte {star} Sterne",
    "form.placeholder.notes": "Notizen (z.B. Geschmack, Anlass, Erinnerungen...)",
    "form.placeholder.tags": "Tags (kommagetrennt, z.B. Snack, süß, Leckerei)",
    "form.placeholder.purchaseLocation": "Wo hast du es gekauft? (z.B. Edeka)",
    "form.label.nutriScore": "Nutri-Score",
    "form.aria.selectNutriScore": "Nutri-Score {score} auswählen",
    "form.ingredients.title": "Zutaten & Ernährung",
    "form.button.scanIngredients": "Zutaten scannen",
    "form.ingredients.loading": "Analysiere Zutaten...",
    "form.dietary.title": "Ernährungsinformationen",
    "form.dietary.lactoseFree": "Laktosefrei",
    "form.dietary.vegan": "Vegan",
    "form.dietary.glutenFree": "Glutenfrei",
    "form.allergens.title": "Mögliche Allergene",
    "form.ingredients.ingredientsList": "Zutaten",
    "form.ingredients.placeholder": "Keine Zutatendaten. Verwenden Sie 'Zutaten scannen', wenn Sie ein Bild der Liste haben.",
    "form.share.title": "Freigabeoptionen",
    "form.share.private": "Privat",
    "form.share.privateDesc": "Nur Sie können diesen Eintrag sehen.",
    "form.share.community": "Mit der Community teilen",
    "form.share.communityDesc": "Machen Sie diesen Eintrag für alle im Entdecken-Tab sichtbar.",
    "form.share.group": "Mit Gruppe teilen",
    "form.share.groupDesc": "Teilen Sie dies mit Mitgliedern einer bestimmten Einkaufsliste.",
    "form.share.selectGroup": "Gruppe auswählen...",
    "form.button.cancel": "Abbrechen",
    "form.button.update": "Eintrag aktualisieren",
    "form.button.save": "Eintrag speichern",
    "form.button.scanBarcode": "Code scannen",
    "form.button.scanNew": "Produkt scannen",
    "form.button.takePhoto": "Foto machen",
    "form.button.upload": "Hochladen",
    "form.button.dictate": "Diktieren",
    "detail.notesTitle": "Notizen",
    "detail.tagsTitle": "Tags",
    "detail.dietaryTitle": "Ernährungsinformationen",
    "detail.allergensTitle": "Mögliche Allergene",
    "detail.ingredientsTitle": "Zutaten",
    "detail.status": "Status",
    "detail.statusPublic": "Öffentlich",
    "detail.statusPrivate": "Privat",
    "addToListModal.title": "'{itemName}' zu einer Liste hinzufügen",
    "addToListModal.quantity": "Menge",
    "addToListModal.selectList": "Liste auswählen",
    "addToListModal.noLists": "Sie haben noch keine Einkaufslisten. Erstellen Sie eine im Gruppen-Tab.",
    "addToListModal.button.add": "Zur Liste hinzufügen",
    "addToListModal.button.cancel": "Abbrechen",
    "toast.addedToList": "'{itemName}' wurde zu {listName} hinzugefügt.",
    "toast.noShoppingLists": "Sie haben noch keine Einkaufslisten. Erstellen Sie eine im Gruppen-Tab, um loszulegen!",
    "shoppingMode.title": "Einkaufsmodus",
    "shoppingMode.empty": "Diese Einkaufsliste ist leer.",
    "shoppingMode.completedItems": "Erledigte Artikel",
    "shoppingMode.quickAddPlaceholder": "Artikel hinzufügen...",
    "shoppingMode.quickAddButton": "Hinzufügen",
    "shoppingMode.menu.manageMembers": "Mitglieder verwalten",
    "shoppingMode.menu.leaveList": "Liste verlassen",
    "shoppingMode.menu.deleteList": "Liste löschen"
};

const fullTranslations: Record<Language, Record<string, string>> = { en, de };

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>(() => {
    const savedLang = localStorage.getItem('language');
    if (savedLang === 'en' || savedLang === 'de') {
      return savedLang;
    }
    // Default to German if browser language is German, otherwise English
    return navigator.language.startsWith('de') ? 'de' : 'en';
  });

  useEffect(() => {
    localStorage.setItem('language', language);
    document.documentElement.lang = language;
  }, [language]);

  const t = useCallback((key: string, options?: Record<string, string | number>) => {
    let translation = fullTranslations[language][key] || fullTranslations['en'][key] || key;
    if (options) {
      Object.entries(options).forEach(([k, v]) => {
        const regex = new RegExp(`{${k}}`, 'g');
        translation = translation.replace(regex, String(v));
      });
    }
    return translation;
  }, [language]);

  const value = { language, setLanguage, t };

  return React.createElement(I18nContext.Provider, { value }, children);
};

export const useTranslation = (): I18nContextType => {
  const context = useContext(I18nContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within an I18nProvider');
  }
  return context;
};